{"filter":false,"title":"user_stories_test.rb","tooltip":"/test/integration/user_stories_test.rb","undoManager":{"mark":35,"position":35,"stack":[[{"group":"doc","deltas":[{"start":{"row":11,"column":2},"end":{"row":13,"column":3},"action":"remove","lines":["# test \"the truth\" do","  #   assert true","  #"]},{"start":{"row":11,"column":2},"end":{"row":65,"column":1},"action":"insert","lines":["fixtures :products","","  # A user goes to the index page. They select a product, adding it to their","  # cart, and check out, filling in their details on the checkout form. When","  # they submit, an order is created containing their information, along with a","  # single line item corresponding to the product they added to their cart.","  ","  test \"buying a product\" do","    LineItem.delete_all","    Order.delete_all","    ruby_book = products(:ruby)","","    get \"/\"","    assert_response :success","    assert_template \"index\"","    ","    xml_http_request :post, '/line_items', product_id: ruby_book.id","    assert_response :success ","    ","    cart = Cart.find(session[:cart_id])","    assert_equal 1, cart.line_items.size","    assert_equal ruby_book, cart.line_items[0].product","    ","    get \"/orders/new\"","    assert_response :success","    assert_template \"new\"","    ","    post_via_redirect \"/orders\",","                      order: { name:     \"Dave Thomas\",","                               address:  \"123 The Street\",","                               email:    \"dave@example.com\",","                               pay_type: \"Check\" }","    assert_response :success","    assert_template \"index\"","    cart = Cart.find(session[:cart_id])","    assert_equal 0, cart.line_items.size","    ","    orders = Order.all","    assert_equal 1, orders.size","    order = orders[0]","    ","    assert_equal \"Dave Thomas\",      order.name","    assert_equal \"123 The Street\",   order.address","    assert_equal \"dave@example.com\", order.email","    assert_equal \"Check\",            order.pay_type","    ","    assert_equal 1, order.line_items.size","    line_item = order.line_items[0]","    assert_equal ruby_book, line_item.product","","    mail = ActionMailer::Base.deliveries.last","    assert_equal [\"dave@example.com\"], mail.to","    assert_equal 'Sam Ruby <depot@example.com>', mail[:from].value","    assert_equal \"Pragmatic Store Order Confirmation\", mail.subject"," "]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":22},"end":{"row":62,"column":23},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":21},"end":{"row":62,"column":22},"action":"remove","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":20},"end":{"row":62,"column":21},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":19},"end":{"row":62,"column":20},"action":"remove","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":19},"end":{"row":62,"column":20},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":20},"end":{"row":62,"column":21},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":21},"end":{"row":62,"column":22},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":22},"end":{"row":62,"column":23},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":23},"end":{"row":62,"column":24},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":19},"end":{"row":62,"column":24},"action":"remove","lines":["depot"]},{"start":{"row":62,"column":19},"end":{"row":62,"column":20},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":20},"end":{"row":62,"column":21},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":21},"end":{"row":62,"column":22},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":62,"column":22},"end":{"row":62,"column":23},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":28},"end":{"row":63,"column":33},"action":"remove","lines":["depot"]},{"start":{"row":63,"column":28},"end":{"row":63,"column":29},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":29},"end":{"row":63,"column":30},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":30},"end":{"row":63,"column":31},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":31},"end":{"row":63,"column":32},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":18},"end":{"row":63,"column":27},"action":"remove","lines":["Sam Ruby "]},{"start":{"row":63,"column":18},"end":{"row":63,"column":19},"action":"insert","lines":["D"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":19},"end":{"row":63,"column":20},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":20},"end":{"row":63,"column":21},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":21},"end":{"row":63,"column":22},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":22},"end":{"row":63,"column":23},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":18},"end":{"row":63,"column":22},"action":"remove","lines":["Dave"]},{"start":{"row":63,"column":18},"end":{"row":63,"column":19},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":19},"end":{"row":63,"column":20},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":20},"end":{"row":63,"column":21},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":21},"end":{"row":63,"column":22},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":22},"end":{"row":63,"column":23},"action":"insert","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":23},"end":{"row":63,"column":24},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":24},"end":{"row":63,"column":25},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":25},"end":{"row":63,"column":26},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":28},"end":{"row":63,"column":32},"action":"remove","lines":["dave"]},{"start":{"row":63,"column":28},"end":{"row":63,"column":29},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":29},"end":{"row":63,"column":30},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":30},"end":{"row":63,"column":31},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":31},"end":{"row":63,"column":32},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":32},"end":{"row":63,"column":33},"action":"insert","lines":["t"]}]}]]},"ace":{"folds":[],"scrolltop":600,"scrollleft":0,"selection":{"start":{"row":47,"column":4},"end":{"row":47,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":41,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1418414752142,"hash":"4d2da4d6ffb6d4cc5c746fc568aa64928e0a7b97"}